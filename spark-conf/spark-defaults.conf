# ===============================================
# CONFIGURACIÓN SPARK PARA 2 WORKERS LIMITADOS
# 2 cores y 1GB RAM por worker máximo
# ===============================================

# SERIALIZACIÓN - Java Serializer para mayor estabilidad
spark.serializer                org.apache.spark.serializer.JavaSerializer
spark.serializer.objectStreamReset    100
spark.kryo.registrationRequired       false
spark.kryo.unsafe               false
spark.kryoserializer.buffer.max 256m
spark.kryoserializer.buffer     64k

# MEMORIA - CONFIGURACIÓN CONSERVADORA
spark.driver.memory             2g
spark.driver.maxResultSize      1g
spark.executor.memory           1g
spark.executor.memoryFraction   0.8

# CPU Y PARALELISMO - OPTIMIZADO PARA 2 WORKERS DE 2 CORES
spark.executor.cores            2
spark.executor.instances        2
spark.sql.shuffle.partitions    4
spark.default.parallelism       4

# CONFIGURACIÓN SQL - DESHABILITADA PARA ESTABILIDAD
spark.sql.adaptive.enabled                    false
spark.sql.adaptive.coalescePartitions.enabled false
spark.sql.adaptive.skewJoin.enabled           false
spark.sql.execution.arrow.pyspark.enabled     false

# TIMEOUTS Y RED - AUMENTADOS PARA MAYOR ESTABILIDAD
spark.network.timeout          600s
spark.executor.heartbeatInterval 60s
spark.rpc.askTimeout            300s
spark.rpc.lookupTimeout         120s

# CONFIGURACIONES ADICIONALES PARA ESTABILIDAD
spark.sql.execution.sortBeforeRepartition              false
spark.sql.execution.useColumnarReaderForSchemaDiscovery false
spark.sql.execution.arrow.pyspark.fallback.enabled     true

# CONFIGURACIÓN DE ALMACENAMIENTO
spark.sql.warehouse.dir         /tmp/spark-warehouse
spark.sql.catalogImplementation hive

# LOGS Y MONITORING
spark.eventLog.enabled          false
spark.ui.retainedJobs           100
spark.ui.retainedStages         100

# CONFIGURACIÓN ESPECÍFICA PARA WORKERS LIMITADOS
spark.worker.cleanup.enabled    true
spark.worker.cleanup.interval   1800
spark.worker.cleanup.appDataTtl 86400

# CONFIGURACIÓN DE SHUFFLE PARA RECURSOS LIMITADOS
spark.shuffle.compress          true
spark.shuffle.spill.compress    true
spark.io.compression.codec      snappy

# CONFIGURACIÓN DE BROADCAST - REDUCIDA PARA MEMORIA LIMITADA
spark.sql.adaptive.advisoryPartitionSizeInBytes    64MB
spark.sql.adaptive.maxShuffledHashJoinLocalMapThreshold  12MB

# DYNAMIC ALLOCATION - DESHABILITADA PARA CONTROL ESTRICTO
spark.dynamicAllocation.enabled false
spark.dynamicAllocation.executorIdleTimeout 60s

# CONFIGURACIÓN DE CHECKPOINT
spark.sql.streaming.checkpointLocation /tmp/spark-checkpoints